$output.file("web/src/app/entities/${entity.model.var}/webapp/customize/customize.js")##
#set( $listFields = [] )
#foreach (${attribute} in ${entity.nonCpkAttributes.list})
	#if(!${attribute.isInFk()} || ${attribute.isSimplePk()})
	    #if(!(${attribute.var}=='id' || ${attribute.var}=='usuarioCreacion' || ${attribute.var}=='fechaCreacion' || ${attribute.var}=='usuarioModificacion' || ${attribute.var}=='fechaModificacion'))
		    #set(${listFields} = ${listFields.add(${attribute.var})})
		#end
	#end
#end

sap.ui.define([
    "./customize",
    "sap/m/MessageBox",
    "../js/utilities",
    "../service/Service"
], function(Customize, MessageBox, Utilities, Service) {
    "use strict";
    return {
        fieldList: [],
        nameEntity: "${entity}",
        nameEntityVar: "${entity.model.var}",
        nameModel: "${entity}List",
        nameModelUpload: "Upload${entity}List",
        doRun: function(context){
            context.oRouter.navTo("Result${entity}");
        },
        getFilters: function(context){
            var that = this;
            var jsonFilter={};
            this.fieldList.map(function(f){
                var nameField = "txt"+that.nameEntity+f;
                var objectField= context.getView().byId(nameField);
                if(objectField !== undefined){
                    if(objectField.getValue()===""){
                        jsonFilter[f]=null;
                    }else{
                        jsonFilter[f]=objectField.getValue();
                    }
                }
            });
            return jsonFilter;
        },
        callRest: function(context, nameEntityVar, nameModel, arg1, arg2){
            var that = this;
            this.fieldList= arg1;
            debugger;
            var jsonFilter= {};
            jsonFilter = this.getFilters(context);
            var txtPage=context.getView().byId("txtPage");
            if(txtPage.getValue()===''){
            	txtPage.setValue(1);
            }
            var numberPage= txtPage.getValue()-1;
            var jsonPaginated={
                "example": jsonFilter,
                "lazyLoadEvent": {
                    "first": numberPage*10,
                    "rows":10
                    }
                };
            //console.log(JSON.stringify(jsonPaginated));
            //Service.doPostGet(context, jsonVersion, nameEntityVar+"/find", nameModel);
            Service.doPostGetLoading(context, jsonPaginated, this.nameEntityVar+"/findPaginated", this.nameModel, "Y", this, "timeFormat");
        },
        callFilter: function(context){
            //No olvidar que si la tabla tiene versi√≥n, los filtros tambien la deben tener
            var that = this;
            var jsonFilter= {};
            jsonFilter = this.getFilters(context);
            #if (${listFields.contains("version")})

            jsonFilter["version"]=sessionStorage.getItem("idVersion");
            #end

            var txtPage=context.getView().byId("txtPage");
            txtPage.setValue(1);
            var jsonPaginated={
                "example": jsonFilter,
                "lazyLoadEvent": {
                    "first": 0,
                    "rows":10
                }
            };
            Service.doPostGetLoading(context, jsonPaginated, this.nameEntityVar+"/findPaginated", this.nameModel, "Y", this, "timeFormat", "Y");
        },
        clearFilter: function(context){
            var that = this;
            this.fieldList.map(function(f){
                var nameField = "txt"+that.nameEntity+f;
                var objectField= context.getView().byId(nameField);
                if(objectField !== undefined){
                    objectField.setValue(null);
                }
            });
            var jsonFilter= {};
            jsonFilter = this.getFilters(context);
            jsonFilter["version"]=sessionStorage.getItem("idVersion");
            var txtPage=context.getView().byId("txtPage");
            txtPage.setValue(1);
            var jsonPaginated={
                "example": jsonFilter,
                "lazyLoadEvent": {
                    "first": 0,
                    "rows":10
                }
            };
            Service.doPostGetLoading(context, jsonPaginated, this.nameEntityVar+"/findPaginated", this.nameModel, "Y", this, "timeFormat", "Y");
        },
        callDelete: function(context, idRow){
            var txtPage=context.getView().byId("txtPage");
            Service.doDelete(context, this.nameEntityVar, idRow, "Y", this, "goPage")
        },
        goPage: function(context, numberPage){
            var jsonFilter= {};
            jsonFilter = this.getFilters(context);
            jsonFilter["version"]=sessionStorage.getItem("idVersion");
            var txtPage=context.getView().byId("txtPage");
            if(txtPage.getValue()==='' || txtPage.getValue()==="0"){
            	txtPage.setValue(1);
            }
            var numberPage= txtPage.getValue()-1;
            var jsonPaginated={
                "example": jsonFilter,
                "lazyLoadEvent": {
                    "first": numberPage*10,
                    "rows":10
                }
            };
            //console.log(JSON.stringify(jsonPaginated));
            Service.doPostGetLoading(context, jsonPaginated, this.nameEntityVar+"/findPaginated", this.nameModel, "Y", this, "timeFormat");
        },
        doBefore: function(context, result){
            var lblNumPages= context.getView().byId("lblNumPages");
            lblNumPages.setText(result.totalPages);
            this.model = new sap.ui.model.json.JSONModel (result.content);
            context.getView().setModel(this.model, this.nameModel);
        },
        doBeforeUpdate: function(context, fieldList){
            var jsonFieldList = context.getObjectFields(context, fieldList);
            jsonFieldList.map(function(f){
                f["objectField"].setEnabled(true);
            });
        },
        doBeforeNew: function(context, fieldList){
            var jsonFieldList = context.getObjectFields(context, fieldList);
            jsonFieldList.map(function(f){
                f["objectField"].setEnabled(true);
            });
        },
        doBeforeDetail: function(context, fieldList){
            var jsonFieldList = context.getObjectFields(context, fieldList);
            jsonFieldList.map(function(f){
                f["objectField"].setEnabled(false);
            });
        },
        timeFormat: function(context, result, nameModel){
        	var values = result.content;
        	debugger;
        	values.map(function(v){
        		if(v["fechaEntrega"]!==undefined){
        		v["fechaEntrega"]=moment.utc(v["fechaEntrega"]).format('DD/MM/YYYY');
        		}
        		if(v["fechaDespacho"]!==undefined){
        		v["fechaDespacho"]=moment.utc(v["fechaDespacho"]).format('DD/MM/YYYY');
        		}
        		if(v["fechaCambio"]!==undefined){
        		v["fechaCambio"]=moment.utc(v["fechaCambio"]).format('DD/MM/YYYY');
        		}
        	})
        	result.content= values;
        	this.doBefore(context,result,this.nameModel);
        },
    };
});